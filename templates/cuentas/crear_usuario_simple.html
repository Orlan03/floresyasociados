{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}
{% block title %}Crear usuario - Flores y Asociados{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

<style>
  :root{
    --navy-900:#071534; --navy-800:#0B1E44; --navy-700:#112759;
    --ink:#EAF0FF; --muted:#9FB0D6;
    --gold-1:#F7D67B; --gold-2:#DCA94F; --gold-3:#B17B2E;
    --ring:rgba(247,214,123,.32);
    --border:rgba(255,255,255,.08);
    --shadow:0 10px 40px rgba(0,0,0,.35);
    --rad:16px;
  }
  body{ background: radial-gradient(1200px 700px at 20% -10%, #132654 0%, var(--navy-900) 55%); color: var(--ink); }
  .wrap{ max-width:920px; margin:32px auto; padding:0 22px; }
  .hdr{
    display:flex; justify-content:space-between; align-items:center; gap:12px;
    background: linear-gradient(180deg, var(--navy-800), rgba(11,30,68,.96));
    border:1px solid var(--border); border-radius: var(--rad);
    padding:16px 18px; margin-bottom:18px; box-shadow: var(--shadow);
  }
  .hdr h1{ margin:0; font-size:1.25rem; font-weight:900; color:#fff; }
  .btn{
    appearance:none; border-radius:12px; padding:10px 14px; font-weight:800; cursor:pointer;
    display:inline-flex; align-items:center; gap:8px; text-decoration:none;
    border:1px solid var(--border); color:var(--ink); background:rgba(255,255,255,.02);
    transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
  }
  .btn:hover{ transform: translateY(-1px); background:rgba(255,255,255,.04); box-shadow: 0 0 0 4px var(--ring) inset; }
  .btn-primary{
    border:0; background: linear-gradient(90deg, var(--gold-1), var(--gold-2));
    color:#1a1a1a; box-shadow: 0 8px 24px rgba(220,169,79,.25);
  }
  .btn-primary:hover{ background: linear-gradient(90deg, var(--gold-2), var(--gold-3)); }

  .card{
    background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
    border:1px solid var(--border); border-radius: var(--rad);
    padding:18px; box-shadow: var(--shadow);
  }
  .grid{ display:grid; gap:14px; grid-template-columns: repeat(auto-fit, minmax(260px,1fr)); }
  .field label{ display:block; font-weight:800; color:#fff; margin:6px 0; }
  .input{
    width:100%; padding:12px 14px; border:1.5px solid rgba(255,255,255,.15); border-radius:12px;
    background:rgba(255,255,255,.06); color:#fff; outline:none;
  }
  .input:focus{ border-color: var(--gold-1); box-shadow: 0 0 0 4px var(--ring); }
  .help{ color:var(--muted); font-size:.9rem; margin-top:4px; }
  .row-action{ display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; }

  .messages{ margin-bottom:12px; display:flex; flex-direction:column; gap:8px; }
  .msg{ padding:10px 12px; border-radius:10px; font-weight:600; }
  .msg-success{ background:rgba(16,185,129,.18); border:1px solid rgba(16,185,129,.35); color:#bff4df; }
  .msg-error{ background:rgba(220,38,38,.18); border:1px solid rgba(220,38,38,.35); color:#ffbdbd; }
  .err{ color:#ffbdbd; font-size:.9rem; margin-top:6px; }
  .checkbox{ display:flex; align-items:center; gap:8px; margin-top:8px; }
  .muted{ color:var(--muted); font-size:.95rem; }
  .section-title{ font-weight:900; color:#fff; margin:4px 0 10px; }
  .pw-toggle{ cursor:pointer; font-size:.9rem; color:var(--muted); margin-left:6px; }
</style>

<div class="wrap">
  <div class="hdr">
    <h1><i class="fa fa-user-plus"></i> Crear usuario</h1>
    <div class="row-action">
      <a class="btn" href="{% url 'cuentas:lista_usuarios' %}"><i class="fa fa-users"></i> Lista de usuarios</a>
      <a class="btn" href="{% url 'dashboard' %}"><i class="fa fa-house"></i> Volver al panel</a>
    </div>
  </div>

  {% if messages %}
    <div class="messages">
      {% for message in messages %}
        <div class="msg {% if message.tags %}msg-{{ message.tags }}{% endif %}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="card">
    <form method="post" novalidate>
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="msg msg-error">{{ form.non_field_errors|striptags }}</div>
      {% endif %}

      <div class="section-title">Datos del usuario</div>
      <div class="grid">
        <div class="field">
          <label for="{{ form.cedula.id_for_label }}">Cédula</label>
          {% render_field form.cedula class="input" placeholder="0102030405" maxlength="10" pattern="\d{10}" %}
          <div class="help">El usuario iniciará sesión con su cédula (10 dígitos).</div>
          {% if form.cedula.errors %}<div class="err">{{ form.cedula.errors|striptags }}</div>{% endif %}
        </div>

        <div class="field">
          <label for="{{ form.first_name.id_for_label }}">Nombres</label>
          {% render_field form.first_name class="input" placeholder="Nombres" %}
          {% if form.first_name.errors %}<div class="err">{{ form.first_name.errors|striptags }}</div>{% endif %}
        </div>

        <div class="field">
          <label for="{{ form.last_name.id_for_label }}">Apellidos</label>
          {% render_field form.last_name class="input" placeholder="Apellidos" %}
          {% if form.last_name.errors %}<div class="err">{{ form.last_name.errors|striptags }}</div>{% endif %}
        </div>

        <div class="field">
          <label for="{{ form.email.id_for_label }}">Correo</label>
          {% render_field form.email class="input" placeholder="correo@empresa.com" %}
          {% if form.email.errors %}<div class="err">{{ form.email.errors|striptags }}</div>{% endif %}
        </div>

        <div class="field">
          <label for="{{ form.telefono.id_for_label }}">Teléfono</label>
          {% render_field form.telefono class="input" placeholder="0999999999" %}
          {% if form.telefono.errors %}<div class="err">{{ form.telefono.errors|striptags }}</div>{% endif %}
        </div>
      </div>

      <div class="section-title" style="margin-top:14px;">Contraseña</div>
      <div class="grid">
        <div class="field">
          <label for="{{ form.password1.id_for_label }}">Contraseña</label>
          <div style="display:flex; gap:8px; align-items:center;">
            {% render_field form.password1 class="input" placeholder="••••••••" id="pw1" %}
            <span class="pw-toggle" onclick="togglePw('pw1')"><i class="fa fa-eye"></i></span>
          </div>
          {% if form.password1.errors %}<div class="err">{{ form.password1.errors|striptags }}</div>{% endif %}
        </div>

        <div class="field">
          <label for="{{ form.password2.id_for_label }}">Repetir contraseña</label>
          <div style="display:flex; gap:8px; align-items:center;">
            {% render_field form.password2 class="input" placeholder="••••••••" id="pw2" %}
            <span class="pw-toggle" onclick="togglePw('pw2')"><i class="fa fa-eye"></i></span>
          </div>
          {% if form.password2.errors %}<div class="err">{{ form.password2.errors|striptags }}</div>{% endif %}
        </div>
      </div>

      <div class="section-title" style="margin-top:14px;">Permisos</div>
      <div class="checkbox">
        {% render_field form.is_staff %}
        <label for="{{ form.is_staff.id_for_label }}" class="muted">Dar acceso al admin (/admin)</label>
      </div>

      <div class="row-action" style="margin-top:18px;">
        <button class="btn btn-primary" type="submit"><i class="fa fa-floppy-disk"></i> Crear usuario</button>
        <a class="btn" href="{% url 'cuentas:lista_usuarios' %}"><i class="fa fa-xmark"></i> Cancelar</a>
      </div>

    </form>
  </div>
</div>

<script>
  function togglePw(id){
    const el = document.getElementById(id);
    if(!el) return;
    el.type = el.type === 'password' ? 'text' : 'password';
  }
</script>
{% endblock %}
